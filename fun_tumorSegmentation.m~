function [BWO, points] = fun_tumorSegmentation(I_CB, pointsOnSlice, ITViP)

%% detected mask
I_CB = uint16(I_CB);
[M, N] = size(I_CB);
% level = graythresh(I_CB);
level = 500/2^16;
BW = imbinarize(I_CB, level);

%% structure mask
BWSS = zeros(size(I_CB));
for n = 1:length(pointsOnSlice)
    pts = pointsOnSlice{n};
    BWS{n} = poly2mask(pts(:,1), pts(:,2), M, N);
    BWSS = or(BWSS, BWS{n});
end

%% overlap
BWO = and(BWSS, BW);
BD = bwboundaries(BWO);
points = length(BD);

% points = cell(nBD, 1);
% 
% for iB = 1:length(BD)
%     pts = BD{iB};
%     for n = 1:length(ITViP)
%         BW_ITV = poly2mask(pts(:,1), pts(:,2), M, N);
%         junk = and(BW, BW_ITV);
%         if any(junk(:))
%             points = [points; pts];
%             break;
%         end        
%     end
% end

%     cent = mean(ITViP{n});  % ITV centroid inside tumor
%     if inpolygon(cent(1), cent(2), pts(:,1), pts(:,2))
%         points = pts;
%         break;
%     end
